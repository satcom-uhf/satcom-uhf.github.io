{"id":2776,"date":"2022-07-18T01:42:00","date_gmt":"2022-07-17T22:42:00","guid":{"rendered":"https:\/\/olegkutkov.me\/?p=2776"},"modified":"2022-07-19T20:24:06","modified_gmt":"2022-07-19T17:24:06","slug":"data-logger-for-uni-t-ut800-multimeters","status":"publish","type":"post","link":"https:\/\/olegkutkov.me\/2022\/07\/18\/data-logger-for-uni-t-ut800-multimeters\/","title":{"rendered":"Data logger for UNI-T UT800 multimeters"},"content":{"rendered":"<p><img loading=\"lazy\" decoding=\"async\" class=\"alignleft size-full wp-image-2777\" src=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804a_thumb.png\" alt=\"\" width=\"150\" height=\"100\" \/>I have been using my uni-t <a href=\"https:\/\/instruments.uni-trend.com\/list_80\/1238.html\">ut804<\/a> bench multimeter for a while.<br \/>\nMy current tasks requires collecting different kinds of measurements for further analysis.<br \/>\nI decided to connect my multimeter to a computer for data capture.<\/p>\n<p>&nbsp;<\/p>\n<p><!--more--><\/p>\n<p>On the back panel of the multimeter, there are two communication ports: USB type B and RS232.<\/p>\n<p><a href=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_ports.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-2779\" src=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_ports.jpg\" alt=\"\" width=\"800\" height=\"411\" srcset=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_ports.jpg 950w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_ports-400x205.jpg 400w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_ports-768x395.jpg 768w\" sizes=\"(max-width: 800px) 100vw, 800px\" \/><\/a><\/p>\n<p>I don&#8217;t have a spare RS232 port on my machine, so I chose the USB.<br \/>\nAfter the connection, I found a new device represented as Dallas 1-wire HID. It&#8217;s not what I expected.<br \/>\nLet&#8217;s open the multimeter to see what&#8217;s inside.<\/p>\n<p>The Communication board mounted on the back panel:<\/p>\n<p><a href=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_top.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-2783\" src=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_top.jpg\" alt=\"\" width=\"800\" height=\"466\" srcset=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_top.jpg 950w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_top-400x233.jpg 400w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_top-768x447.jpg 768w\" sizes=\"(max-width: 800px) 100vw, 800px\" \/><\/a><\/p>\n<p>We can see an optocoupler on the IR diode\/photodiode pair. It&#8217;s a simple TX-only channel.<\/p>\n<p>Bottom of the board:<\/p>\n<p><a href=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_bottom.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-2785\" src=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_bottom.jpg\" alt=\"\" width=\"800\" height=\"469\" srcset=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_bottom.jpg 950w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_bottom-400x235.jpg 400w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_comm_board_bottom-768x450.jpg 768w\" sizes=\"(max-width: 800px) 100vw, 800px\" \/><\/a><\/p>\n<p>The USB interface is Holtek HE2325U &#8211; an HID-based USB Serial Converter. Also, there is a photodiode amplifier with two buffers &#8211; for USB and RS232 lines.<\/p>\n<p>I couldn&#8217;t find a lot of information about this HE2325U. It seems that all the code that I found is outdated. It&#8217;s not working on my modern Debian system. And there is no straightforward way to get serial data.<\/p>\n<p>Interestingly, the <a href=\"https:\/\/sigrok.org\/wiki\/UNI-T_UT804\">newer versions of the multimeter<\/a> use a regular CH9325 UART to USB converter.<\/p>\n<p>The board uses a dual-power supply option for USB and RS232. USB 5V is fed directly to the amplifier section and the Holtek interface.<br \/>\nFor RS232, they used a DTR line that remains active (3 to 25 Volts) when the host is ready to receive the data.<\/p>\n<p>Block diagram of the interface board:<\/p>\n<p><a href=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_interface_block_diagram.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-2791\" src=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_interface_block_diagram.png\" alt=\"\" width=\"850\" height=\"435\" srcset=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_interface_block_diagram.png 1014w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_interface_block_diagram-400x205.png 400w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_interface_block_diagram-768x393.png 768w\" sizes=\"(max-width: 850px) 100vw, 850px\" \/><\/a><\/p>\n<p>To work with RS232 without an RS232 port, it&#8217;s possible to use MAX232\/MAX3232 converter plus any UART to USB interface.<\/p>\n<p>Luckily, I have plenty of cheap MAX3232 interface boards.<\/p>\n<p><a href=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_a.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-2793\" src=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_a.jpg\" alt=\"\" width=\"594\" height=\"333\" srcset=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_a.jpg 950w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_a-400x224.jpg 400w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_a-768x430.jpg 768w\" sizes=\"(max-width: 594px) 100vw, 594px\" \/><\/a><\/p>\n<p>To solve the power problem, I connected the DTR pin directly to the input VCC line, which is 5V in my case. This voltage is enough for the photodiode amplifier and RS232 buffer.<\/p>\n<p><a href=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_hack.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-2795\" src=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_hack.jpg\" alt=\"\" width=\"800\" height=\"393\" srcset=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_hack.jpg 950w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_hack-400x197.jpg 400w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/max3232_board_hack-768x378.jpg 768w\" sizes=\"(max-width: 800px) 100vw, 800px\" \/><\/a><\/p>\n<p>This simple operation helped me to get the multimeter data out of my <code>\/dev\/ttyUSBx<\/code> interface.<\/p>\n<h3>Software<\/h3>\n<p>I wrote a small program <a href=\"https:\/\/github.com\/olegkutkov\/ut-reader\">ut-reader [GitHub]<\/a> to read the multimeter data. The program prints the data in CSV or tab-separated format. Also, it&#8217;s possible to configure a timestamp format.<br \/>\nThis program is designed for the UT800 series but <em>might<\/em> also work with other models like UT61. I need to test this.<\/p>\n<p>There are no special requirements, so the program could be compiled on all modern Linux distros and macOS.<\/p>\n<p>Here is some real usage example:<\/p>\n<blockquote>\n<pre class=\"notranslate\"><code>ut_reader -d \/dev\/ttyUSB2 -c\nSerial device \/dev\/ttyUSB2 with baud rate = 2400\nStarting capture, press Ctrl-C to stop2022-07-17 01:29:37,00.280,A\n2022-07-17 01:29:38,00.283,A\n2022-07-17 01:29:39,00.298,A\n2022-07-17 01:29:39,00.315,A\n2022-07-17 01:29:40,00.318,A\n2022-07-17 01:29:41,01.191,A\n2022-07-17 01:29:41,01.188,A\n2022-07-17 01:29:42,01.186,A\n2022-07-17 01:29:43,01.194,A\n2022-07-17 01:29:43,01.194,A\n2022-07-17 01:29:44,02.090,A\n2022-07-17 01:29:45,02.089,A\n2022-07-17 01:29:45,02.088,A\n2022-07-17 01:29:46,02.086,A\n2022-07-17 01:29:47,02.084,A\n2022-07-17 01:29:47,00.366,A\n2022-07-17 01:29:48,00.364,A\n...<\/code><\/pre>\n<\/blockquote>\n<p>Now it&#8217;s possible to build a nice current consumption graph with <a href=\"http:\/\/www.gnuplot.info\/\">gnuplot<\/a>.<br \/>\nut-reader output was saved to a unit-t.csv file.<\/p>\n<blockquote><p>gnuplot&gt; set xdata time<br \/>\ngnuplot&gt; set timefmt &#8220;%Y-%m-%d %H:%M:%S&#8221;<br \/>\ngnuplot&gt; set format x &#8220;%H:%M:%S&#8221;<br \/>\ngnuplot&gt; plot &#8216;unit-t.csv&#8217; using 1:2 with lines title &#8216;Current consumption&#8217;<\/p><\/blockquote>\n<p><a href=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_gnuplot_out.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-large wp-image-2804\" src=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_gnuplot_out-1024x501.png\" alt=\"\" width=\"850\" height=\"416\" srcset=\"https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_gnuplot_out-1024x501.png 1024w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_gnuplot_out-400x196.png 400w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_gnuplot_out-768x376.png 768w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_gnuplot_out-1536x752.png 1536w, https:\/\/olegkutkov.me\/wp-content\/uploads\/2022\/07\/ut804_gnuplot_out.png 1918w\" sizes=\"(max-width: 850px) 100vw, 850px\" \/><\/a><\/p>\n<p>Thanks for reading.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I have been using my uni-t ut804 bench multimeter for a while. My current tasks requires collecting different kinds of measurements for further analysis. I decided to connect my multimeter to a computer for data capture. &nbsp;<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[30,122,25,54],"tags":[138,137,134,135,136],"_links":{"self":[{"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/posts\/2776"}],"collection":[{"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/comments?post=2776"}],"version-history":[{"count":28,"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/posts\/2776\/revisions"}],"predecessor-version":[{"id":2820,"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/posts\/2776\/revisions\/2820"}],"wp:attachment":[{"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/media?parent=2776"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/categories?post=2776"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/olegkutkov.me\/wp-json\/wp\/v2\/tags?post=2776"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}